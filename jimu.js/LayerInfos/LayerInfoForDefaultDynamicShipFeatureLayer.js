// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/Deferred esri/layers/FeatureLayer esri/tasks/query ./LayerInfoForDefaultDynamic".split(" "),function(g,d,e,h,k,l){return g(l,{_msShipFeatureLayerId:null,_msOwnedFeatureLayerDef:null,_msOwnedLayerInfo:null,constructor:function(a,b){this._msShipFeatureLayerId=a.msShipFLayerId},_initAfterRootLayerInfo:function(){var a=this.map.getLayer(this._msShipFeatureLayerId);a&&this._initPopupInfo(a)},_initPopupInfo:function(a){var b=this.originOperLayer.mapService.layerInfo,
c=this.originOperLayer.mapService.subId;a&&(a.infoTemplate?(b.controlPopupInfo.infoTemplates[c]={infoTemplate:a.infoTemplate,layerUrl:this.getUrl()},this.enablePopup()):(b.controlPopupInfo.infoTemplates[c]={infoTemplate:null,layerUrl:this.getUrl()},this.disablePopup()))},_initMSOwnedFeatureLayer:function(){var a=this.map.getLayer(this.id),b=this.map.getLayer(this._msShipFeatureLayerId);if(b&&!a){this._msOwnedFeatureLayerDef=new e;a=new h(b.url,d.mixin({},b));a.id=this.id;a.visible=this.isShowInMap();
d.setObject("_wabProperties.isMSOwnedFeatureLayer",!0,a);this.map.addLayer(a);this._initMsOwnedLayerInfo(a);var c=a.on("load",d.hitch(this,function(){this.layerObject=a;this._msOwnedFeatureLayerDef.resolve(a);c.remove&&c.remove()}))}},_initMsOwnedLayerInfo:function(a){this._msOwnedLayerInfo=this._layerInfoFactory.create({layerObject:a,title:this.title+"_owned_",id:a.id},this.map)},_msShipIsValid:function(){var a=this.map.getLayer(this._msShipFeatureLayerId),b=this.map.getLayer(this.id);return a&&
b},getMSShipFeatures:function(a){var b=new e,c=this.map.getLayer(this._msShipFeatureLayerId);if(a&&c){var f=new k;f.objectIds=a.map(d.hitch(this,function(a){return a.attributes[c.objectIdField]}));c.queryFeatures(f,d.hitch(this,function(a){b.resolve(a.features)}),d.hitch(this,function(){b.resolve(null)}))}else b.resolve(null);return b}})});