// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define(["dojo/_base/lang","dojo/_base/html","dojo/query","dojo/keys","dojo/on"],function(h,e,g,d,l){var f={firstFocusNodeClass:"firstFocusNode",lastFocusNodeClass:"lastFocusNode",isInNavMode:function(){return e.hasClass(document.body,"jimu-nav-mode")?!0:!1},initTabIndexAndOrder:function(a){var b=f.getFirstFocusNode(a.domNode,a.inPanel),c=f.getLastFocusNode(a.domNode);b&&!c&&(c=b);a.isController&&(b=c=null);f.initFirstFocusNode(a.domNode,b);f.initLastFocusNode(a.domNode,c)},isCommonOnScreenWidget:function(a){return a.isOnScreen&&
!0!==a.closeable},preventMapNavigation:function(a){0<=[d.NUMPAD_PLUS,61,187,d.NUMPAD_MINUS,173,189,d.UP_ARROW,d.NUMPAD_8,d.RIGHT_ARROW,d.NUMPAD_6,d.DOWN_ARROW,d.NUMPAD_2,d.LEFT_ARROW,d.NUMPAD_4,d.PAGE_UP,d.NUMPAD_9,d.PAGE_DOWN,d.NUMPAD_3,d.END,d.NUMPAD_1,d.HOME,d.NUMPAD_7].indexOf(a.keyCode)&&a.stopPropagation()},initWidgetCancelEvent:function(a){e.setAttr(a.domNode,"role","application");l(a.domNode,"keydown",h.hitch(this,function(b){f.preventMapNavigation(b);var c=b.target;window.isMoveFocusFromMap=
!1;a.inPanel||0>[d.ENTER,d.ESCAPE].indexOf(b.keyCode)||(f.isCommonOnScreenWidget(a)?b.keyCode===d.ENTER&&e.hasClass(c,a.baseClass)?(b.preventDefault(),f.focusFirstFocusNode(a.domNode)):b.keyCode===d.ESCAPE&&(e.hasClass(c,a.baseClass)?(b="jimu-layout-manager"===e.getAttr(a.domNode.parentNode,"id")?a.domNode:a.domNode.parentNode,f.trapToNextFocusContainer(b,!1)):(b.stopPropagation(),a.domNode.focus())):b.keyCode!==d.ESCAPE||e.hasClass(c,a.baseClass)||(a.domNode.focus(),a.onClose(),b.preventDefault(),
b.stopPropagation()))}))},initFirstFocusNode:function(a,b){var c=f.getFirstFocusNode(a);c&&(e.removeClass(c,f.firstFocusNodeClass),c.firstNodeEvent&&c.firstNodeEvent.remove(),c===a&&e.setAttr(c,"tabindex",null));b&&(b===a&&e.setAttr(b,"tabindex",0),e.addClass(b,f.firstFocusNodeClass),b.firstNodeEvent=l(b,"keydown",h.hitch(this,function(b){if(e.hasClass(b.target,f.firstFocusNodeClass)&&b.keyCode===d.TAB)if(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode)window.currentMsgPopup.focusedNodeBeforeOpen=
b.target,b.preventDefault(),window.currentMsgPopup.firstFocusNode.focus();else{var c=g(".jimu-widget-splash",g("#jimu-layout-manager")[0])[0];c&&"none"!==e.getStyle(c,"display")&&c!==a?(b.preventDefault(),g("."+f.firstFocusNodeClass,c)[0].focus()):b.shiftKey&&(b.preventDefault(),f.getLastFocusNode(a).focus())}})))},initLastFocusNode:function(a,b){var c=f.getLastFocusNode(a);c&&(e.removeClass(c,f.lastFocusNodeClass),c.lastNodeEvent&&c.lastNodeEvent.remove(),c===a&&e.setAttr(c,"tabindex",null));b&&
(b===a&&e.setAttr(b,"tabindex",0),e.addClass(b,f.lastFocusNodeClass),b.lastNodeEvent=l(b,"keydown",h.hitch(this,function(c){if(!c.shiftKey&&c.keyCode===d.TAB)if(a===b)c.preventDefault(),this.focusFirstFocusNode(a);else{var m=this.getFocusNodesInDom(b);0===m.length?(c.preventDefault(),this.focusFirstFocusNode(a)):e.hasClass(c.target,f.lastFocusNodeClass)||m[m.length-1]!==c.target||(c.preventDefault(),this.focusFirstFocusNode(a))}})))},focusFirstFocusNode:function(a){var b=g("."+f.firstFocusNodeClass,
a)[0];(b?b:a).focus()},getFirstFocusNode:function(a,b){var c=e.hasClass(a,f.firstFocusNodeClass)?a:g("."+f.firstFocusNodeClass,a)[0];!c&&b&&(c=a,null===e.getAttr(c,"tabindex")&&e.setAttr(c,"tabindex",0));return c},getLastFocusNode:function(a){return e.hasClass(a,f.lastFocusNodeClass)?a:g("."+f.lastFocusNodeClass,a)[0]},traversalDom:function(a,b){b=b?b:[];for(var c=a.childNodes,e=0;e<c.length;e++)a=c[e],1===a.nodeType&&(b.push(a),f.traversalDom(a,b));return b},getFocusNodesInDom:function(a){var b=
["A","INPUT","BUTTON","FORM"];a=f.traversalDom(a);for(var c=[],d=0;d<a.length;d++){var k=a[d],g="presentation"!==e.getAttr(k,"role"),n="hidden"!==e.getAttr(k,"type"),p=!0!==e.getAttr(k,"disabled"),h=e.getAttr(k,"tabindex");g&&n&&p&&(0<=b.indexOf(k.tagName)&&-1!==h||"DIV"===k.tagName&&h&&0<=h)&&c.push(k)}return c},trapToNextFocusContainer:function(a,b){for(var c=a.parentNode.children,d=[],f=0;f<c.length;f++){var g=c[f];0<e.getAttr(g,"tabindex")&&"none"!==e.getStyle(g,"display")&&d.push(g)}d.sort(function(a,
b){a=e.getAttr(a,"tabindex");b=e.getAttr(b,"tabindex");return a<b?-1:a===b?0:1});c=null;if(b)c=d[0];else if("none"===e.getStyle(a,"display"))c=d[0];else for(a=e.getAttr(a,"tabindex"),b=0;b<d.length;b++)if(e.getAttr(d[b],"tabindex")===a){c=b===d.length-1?d[0]:d[b+1];break}c.focus();return c},addTooltipByDomNode:function(){}};return f});