// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array jimu/accessibleUtils dojo/on dojo/keys dijit/a11yclick dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(m,c,d,k,n,g,f,p,q,r,t,u,v){var h=null,l=m([r,t],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv role\x3d"title" class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode" tabindex\x3d"0"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._setFocusedNodeBeforeOpen();this.inherited(arguments);this.hide();this.menuItems=[];this.own(g(this.domNode,"click",d.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||c.isDescendant(a,this.menuNode)||this.hide()})));this._a11y_addEvents()},_setFocusedNodeBeforeOpen:function(){this.focusedNodeBeforeOpen=document.activeElement},_a11y_addEvents:function(){this.own(g(this.labelNode,"keydown",d.hitch(this,function(a){a.shiftKey&&a.keyCode===f.TAB&&(a.preventDefault(),
this.hide())})));this.own(g(this.closeBtn,p,d.hitch(this,this.hide)));this.own(g(this.menuContent,"focus",d.hitch(this,function(){this.currentMenuItem=this.menuItems[0].domNode;k.forEach(this.menuItems,function(a){c.hasClass(a.domNode,"selected")&&(this.currentMenuItem=a.domNode)});this.currentMenuItem.focus()})));this.own(g(this.menuContent,"keydown",d.hitch(this,function(a){a.keyCode===f.ESCAPE&&(a.stopPropagation(),this.hide());if(c.hasClass(a.target,"popup-menu-item"))if(a.keyCode!==f.TAB||(!a.shiftKey||
this.hasTitle)&&a.shiftKey){var b;a.keyCode===f.DOWN_ARROW?b=this.currentMenuItem.nextSibling?this.currentMenuItem.nextSibling:this.currentMenuItem:a.keyCode===f.UP_ARROW?b=this.currentMenuItem.previousSibling?this.currentMenuItem.previousSibling:this.currentMenuItem:a.keyCode===f.HOME?b=this.menuItems[0].domNode:a.keyCode===f.END&&(b=this.menuItems[this.menuItems.length-1].domNode);b&&(this.currentMenuItem=b,b.focus())}else a.preventDefault(),this.hide()})))},setActions:function(a){this.clearActions();
k.forEach(a,d.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];c.empty(this.menuContent)},_addMenuItem:function(a){var b=new v({action:a});c.place(b.domNode,this.menuContent);b.startup();this.menuItems.push(b);this.own(g(b,"click",d.hitch(this,function(a){a?(a=0<=["ShowStatistics","SaveToMyContent","ChangeSymbol"].indexOf(b.action.name),n.isInNavMode()&&a||this.hide()):this.hide()})))},markAsSelected:function(a){k.forEach(this.menuItems,
function(b){b.action.label===a.label?b.setSelected(!0):b.setSelected(!1)})},prepareActions:function(a,b){return u.getInstance().getSupportedActions(a).then(d.hitch(this,function(c){!1===b&&(c=k.filter(c,function(a){return 0!==a.name.indexOf("Export")&&"SaveToMyContent"!==a.name}));k.forEach(c,function(b){b.data=a},this);this.setActions(c)}))},hide:function(){c.setStyle(this.domNode,"display","none");this.focusedNodeBeforeOpen&&this.focusedNodeBeforeOpen.focus()},show:function(a,b){if(0===this.menuItems.length)c.setStyle(this.domNode,
"display","none");else{"string"===typeof b&&""!==b?(this.labelNode.innerHTML=b,c.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",c.setStyle(this.titleNode,"display","none"));var d=a.y+a.h,e;a=window.isRTL?a.x:a.x+a.w;c.setStyle(this.domNode,"display","");c.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});e=q.getMarginSize(this.menuNode);c.setStyle(this.menuNode,{left:(window.isRTL?a+e.w>window.innerWidth?window.innerWidth-e.w:0>a?0:a:0>a-e.w?0:a>window.innerWidth?
window.innerWidth-e.w:a-e.w)+"px",top:(e.h>window.innerHeight?0:d+e.h>window.innerHeight?window.innerHeight-e.h:d+e.h+5<window.innerHeight?d+5:d)+"px"});"string"===typeof b&&""!==b?(this.labelNode.focus(),this.hasTitle=!0):(this.menuContent.focus(),this.hasTitle=!1)}}});l.getInstance=function(){null===h&&(h=new l,c.place(h.domNode,document.body),h.startup());h.setActions([]);return h};return l});